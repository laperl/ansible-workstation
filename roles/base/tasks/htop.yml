---
# roles/base/tasks/htop.yml
#
# üß© Caso especial: htop
# ----------------------
# htop sobrescribe su configuraci√≥n (htoprc) al guardar cambios desde la interfaz
# y, adem√°s, puede reemplazar un symlink mediante create+rename.
# Por eso **NO** usamos Stow aqu√≠: en lugar de enlazar, **copiamos** el fichero
# desde este rol a ~/.config/htop/htoprc, evitando que una escritura rompa el
# enlace y, de paso, asegurando que el repositorio no se modifica.
#
# Nota: el fichero fuente se guarda en roles/base/files/htop/htoprc
# (ver secci√≥n 3).

- name: Soft htop | asegurar directorio de config
  ansible.builtin.file:
    path: "{{ workstation_facts_home }}/.config/htop"
    state: directory
    mode: "0755"
    owner: "{{ workstation_facts_user }}"
    group: "{{ workstation_facts_user }}"
  tags: ['dotfiles', 'htop']

- name: Soft htop | desplegar htoprc (copia, NO symlink)
  ansible.builtin.copy:
    src: "htoprc"   # relativo a roles/base/files/
    dest: "{{ workstation_facts_home }}/.config/htop/htoprc"
    mode: "0664"
    owner: "{{ workstation_facts_user }}"
    group: "{{ workstation_facts_user }}"
  tags: ['dotfiles', 'htop']

# (Opcional) Si alg√∫n d√≠a quieres blindarlo:
# - name: Soft htop | marcar inmutable (ext4, etc.)
#   ansible.builtin.command: chattr +i {{ workstation_facts_home }}/.config/htop/htoprc
#   changed_when: false
#   failed_when: false
#   tags: ['dotfiles', 'htop']
